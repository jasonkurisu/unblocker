<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>UID Access Page</title>
</head>
<body>
  <script>
    var nuke = false;

    // Whitelist: name + UID combo
    const whitelist = [
      { name: "Chris", uid: "1234567" },
      { name: "Bob", uid: "7654321" },
      { name: "Christopher", uid: "9876543" },
    ];

    // Generate a random 7-digit UID
    function generateUID() {
      return Math.floor(1000000 + Math.random() * 9000000).toString();
    }

    // Prompt for name and assign UID
    function firstTimeSetup() {
      try {
        const name = prompt("Enter your name:");
        if (!name) {
          alert("Name is required.");
          window.close();
          return;
        }

        const uid = generateUID();
        localStorage.setItem("userName", name);
        localStorage.setItem("userUID", uid);

        alert(`Your UID is: ${uid}\nPlease reopen the page.`);
        window.close();
      } catch (error) {
        alert("Error during setup: " + error.message);
      }
    }

    // Check if user is in the whitelist
    function isWhitelisted(name, uid) {
      return whitelist.some(entry => entry.name === name && entry.uid === uid);
    }

    // Load content from URL
    async function loadContent() {
      const main = "https://raw.githubusercontent.com/jasonkurisu/unblocker/refs/heads/main/index.html";
      const fallback = "https://cdn.jsdelivr.net/gh/Blobby-Boi/ExtPrint3r/index.html";

      try {
        const response = await fetch(main);
        if (!response.ok) throw new Error("Primary URL failed");
        const html = await response.text();
        document.open();
        document.write(html);
        document.close();
      } catch (err1) {
        alert("Primary failed: " + err1.message);
        try {
          const fallbackResponse = await fetch(fallback);
          if (!fallbackResponse.ok) throw new Error("Fallback URL failed");
          const html = await fallbackResponse.text();
          document.open();
          document.write(html);
          document.close();
        } catch (err2) {
          alert("Fallback failed: " + err2.message);
          window.close();
        }
      }
    }

    // Entry point
    function initiate22() {
      try {
        if (nuke) {
          alert("Access denied. Killswitch is active.");
          window.close();
          return;
        }

        const name = localStorage.getItem("userName");
        const uid = localStorage.getItem("userUID");

        if (!name || !uid) {
          firstTimeSetup(); // prompts and ends
          return;
        }

        if (!isWhitelisted(name, uid)) {
          alert("Access denied. You are not whitelisted.");
          window.close();
          return;
        }

        console.log("Access granted to", name, "with UID:", uid);
        loadContent();
      } catch (error) {
        alert("Unexpected error: " + error.message);
        window.close();
      }
    }

    initiate22();
  </script>
</body>
</html>
